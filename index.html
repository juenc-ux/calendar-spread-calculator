<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Spread Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-4xl font-bold mb-2">Calendar Spread Calculator</h1>
            <p class="text-gray-600 mb-8">Forward Volatility and Calendar Spread Pricing</p>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div class="lg:col-span-1 space-y-4">
                    <h2 class="text-lg font-bold mb-4">Parameters</h2>
                    
                    <div>
                        <label class="block text-sm font-semibold mb-2">Expiration 1</label>
                        <input type="date" id="date1" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Expiration 2</label>
                        <input type="date" id="date2" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">IV Exp 1 (%)</label>
                        <input type="number" id="iv1" value="50" step="0.1" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">IV Exp 2 (%)</label>
                        <input type="number" id="iv2" value="40" step="0.1" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Stock Price</label>
                        <input type="number" id="spotPrice" value="100" step="0.01" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Strike</label>
                        <input type="number" id="strikePrice" value="100" step="0.01" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Risk-Free Rate (%)</label>
                        <input type="number" id="riskFreeRate" value="4" step="0.01" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg">
                    </div>
                    <button onclick="calculate()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg">Calculate</button>
                </div>

                <div id="results" class="lg:col-span-3" style="display:none;">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-green-50 border-2 border-green-500 p-4 rounded-lg">
                            <p class="text-xs text-gray-600">Forward Volatility</p>
                            <p class="text-3xl font-bold text-green-600" id="forwardVol">0%</p>
                        </div>
                        <div class="bg-yellow-50 border-4 border-yellow-500 p-4 rounded-lg">
                            <p class="text-xs text-gray-600">Forward Factor</p>
                            <p class="text-3xl font-bold text-yellow-600" id="forwardFac">0%</p>
                        </div>
                    </div>

                    <div class="bg-red-50 border-4 border-red-600 p-6 rounded-lg mb-4">
                        <p class="text-lg font-bold mb-4">TARGET PRICE FOR FF 30%</p>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-white border-2 border-red-400 p-4 rounded">
                                <p class="text-sm font-semibold mb-2">CALL</p>
                                <p class="text-4xl font-bold text-red-600" id="callFF30">$0.00</p>
                            </div>
                            <div class="bg-white border-2 border-red-400 p-4 rounded">
                                <p class="text-sm font-semibold mb-2">PUT</p>
                                <p class="text-4xl font-bold text-red-600" id="putFF30">$0.00</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 border-4 border-blue-600 p-6 rounded-lg">
                        <p class="text-lg font-bold mb-4">CURRENT SPREADS</p>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-white border-2 border-blue-400 p-4 rounded">
                                <p class="text-sm font-semibold">CALL: <span id="callCurr">$0.00</span></p>
                                <p class="text-xs text-gray-600 mt-2">FF 0%: <span id="callFF0">$0.00</span></p>
                            </div>
                            <div class="bg-white border-2 border-pink-400 p-4 rounded">
                                <p class="text-sm font-semibold">PUT: <span id="putCurr">$0.00</span></p>
                                <p class="text-xs text-gray-600 mt-2">FF 0%: <span id="putFF0">$0.00</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function normDist(x) {
            const a1=0.254829592, a2=-0.284496736, a3=1.421413741, a4=-1.453152027, a5=1.061405429, p=0.3275911;
            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x) / Math.sqrt(2);
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x));
            return 0.5 * (1.0 + sign * y);
        }

        function bs_call(S, K, T, r, sig, q=0) {
            if (T <= 0 || sig <= 0) return Math.max(S - K, 0);
            const st = Math.sqrt(T);
            const d1 = (Math.log(S/K) + (r-q+0.5*sig*sig)*T)/(sig*st);
            const d2 = d1 - sig*st;
            return S*Math.exp(-q*T)*normDist(d1) - K*Math.exp(-r*T)*normDist(d2);
        }

        function bs_put(S, K, T, r, sig, q=0) {
            if (T <= 0 || sig <= 0) return Math.max(K - S, 0);
            const st = Math.sqrt(T);
            const d1 = (Math.log(S/K) + (r-q+0.5*sig*sig)*T)/(sig*st);
            const d2 = d1 - sig*st;
            return K*Math.exp(-r*T)*normDist(-d2) - S*Math.exp(-q*T)*normDist(-d1);
        }

        function calculate() {
            const d1 = new Date(document.getElementById('date1').value);
            const d2 = new Date(document.getElementById('date2').value);
            const now = new Date();
            
            d1.setHours(22,0,0,0);
            d2.setHours(22,0,0,0);
            
            const dt1 = (d1 - now) / (24*60*60*1000);
            const dt2 = (d2 - now) / (24*60*60*1000);
            const T1 = dt1/365, T2 = dt2/365;
            
            const v1 = parseFloat(document.getElementById('iv1').value)/100;
            const v2 = parseFloat(document.getElementById('iv2').value)/100;
            const S = parseFloat(document.getElementById('spotPrice').value);
            const K = parseFloat(document.getElementById('strikePrice').value);
            const r = parseFloat(document.getElementById('riskFreeRate').value)/100;
            
            const num = T2*v2*v2 - T1*v1*v1;
            const fvol = Math.sqrt(num/(T2-T1));
            const ff = (v1/fvol - 1)*100;
            
            document.getElementById('forwardVol').textContent = (fvol*100).toFixed(2) + '%';
            document.getElementById('forwardFac').textContent = ff.toFixed(2) + '%';
            
            const c1 = bs_call(S, K, T1, r, v1);
            const c2 = bs_call(S, K, T2, r, v2);
            const p1 = bs_put(S, K, T1, r, v1);
            const p2 = bs_put(S, K, T2, r, v2);
            
            const rv30 = v1/1.3;
            const iv2_30 = Math.sqrt((rv30*rv30*(T2-T1) + T1*v1*v1)/T2);
            const c2_30 = bs_call(S, K, T2, r, iv2_30);
            const p2_30 = bs_put(S, K, T2, r, iv2_30);
            
            const iv2_0 = Math.sqrt((v1*v1*(T2-T1) + T1*v1*v1)/T2);
            const c2_0 = bs_call(S, K, T2, r, iv2_0);
            const p2_0 = bs_put(S, K, T2, r, iv2_0);
            
            document.getElementById('callFF30').textContent = '$' + Math.max(0, c2_30-c1).toFixed(2);
            document.getElementById('putFF30').textContent = '$' + Math.max(0, p2_30-p1).toFixed(2);
            document.getElementById('callCurr').textContent = '$' + (c2-c1).toFixed(2);
            document.getElementById('putCurr').textContent = '$' + (p2-p1).toFixed(2);
            document.getElementById('callFF0').textContent = '$' + (c2_0-c1).toFixed(2);
            document.getElementById('putFF0').textContent = '$' + (p2_0-p1).toFixed(2);
            
            document.getElementById('results').style.display = 'grid';
        }
    </script>
</body>
</html>